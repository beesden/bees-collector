version: '3'

services:

  ionic:
    image: node
    command: bash -c 'npm install && npm run build -- --prod'
    working_dir: /build
    volumes:
      - /build/node_modules
      - ./ionic:/build
      - ./dist/www:/build/www

  cordova:
    command: bash -c 'npm install && npm run build'
    depends_on:
      - ionic
    environment:
      - CI=true
    image: beesden/cordova
    working_dir: /build
    volumes:
      - /build/node_modules
      - ./cordova:/build
      - ./dist/platforms:/build/platforms
      - ./dist/www:/build/www

  android_debug:
    command: gradle assembleDebug
    image: beesden/android
    working_dir: /build/android
    volumes:
      - gradle:/root/.gradle
      - ./dist/platforms:/build
      - ./dist/android:/build/android/app/build/outputs/apk

  android_release:
    command: gradle assembleRelease
    image: beesden/android
    working_dir: /build/android
    volumes:
      - gradle:/root/.gradle
      - ./dist/platforms:/build
      - ./dist/android:/build/android/app/build/outputs/apk


volumes:
  gradle:
